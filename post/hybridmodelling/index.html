<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Victor Boussange" />

  
  
  
    
  
  <meta name="description" content="In this post, I explore the benefits and drawbacks of using empirical (ML)-based models versus mechanistic models for predicting ecosystem responses to perturbations, and further develeop a hybrid approach combining their strengths." />

  
  <link rel="alternate" hreflang="en-us" href="https://vboussange.github.io/post/hybridmodelling/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha512-W0xM4mr6dEP9nREo7Z9z+9X70wytKvMGeDsj7ps2+xg5QPrEBXC8tAW1IFnzjR6eoJ90JmCnFzerQJTLzIEHjA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.e86434ae70bd28d2a9bb384cdaa99ea3.css" />

  



  


  


  




  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hua3c898eed18b98379688891d5011a1d0_203625_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hua3c898eed18b98379688891d5011a1d0_203625_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://vboussange.github.io/post/hybridmodelling/" />

  
  
  
  
  
  
  
  
    
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary" />
  
    <meta property="twitter:site" content="@wowchemy" />
    <meta property="twitter:creator" content="@wowchemy" />
  
  <meta property="og:site_name" content="Victor Boussange" />
  <meta property="og:url" content="https://vboussange.github.io/post/hybridmodelling/" />
  <meta property="og:title" content="On combining machine learning-based and theoretical ecosystem models | Victor Boussange" />
  <meta property="og:description" content="In this post, I explore the benefits and drawbacks of using empirical (ML)-based models versus mechanistic models for predicting ecosystem responses to perturbations, and further develeop a hybrid approach combining their strengths." /><meta property="og:image" content="https://vboussange.github.io/media/icon_hua3c898eed18b98379688891d5011a1d0_203625_512x512_fill_lanczos_center_3.png" />
    <meta property="twitter:image" content="https://vboussange.github.io/media/icon_hua3c898eed18b98379688891d5011a1d0_203625_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2023-03-31T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2023-03-31T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://vboussange.github.io/post/hybridmodelling/"
  },
  "headline": "On combining machine learning-based and theoretical ecosystem models",
  
  "datePublished": "2023-03-31T00:00:00Z",
  "dateModified": "2023-03-31T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Victor Boussange"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Victor Boussange",
    "logo": {
      "@type": "ImageObject",
      "url": "https://vboussange.github.io/media/icon_hua3c898eed18b98379688891d5011a1d0_203625_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "In this post, I explore the benefits and drawbacks of using empirical (ML)-based models versus mechanistic models for predicting ecosystem responses to perturbations, and further develeop a hybrid approach combining their strengths."
}
</script>

  

  

  

  

<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
inlineMath: [ ['$','$'], ["\\(","\\)"] ],
processEscapes: true
}
});
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  <title>On combining machine learning-based and theoretical ecosystem models | Victor Boussange</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="83c6968528d073ad6e1dfa2201816da4" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.e22a2a20712150175b9cd707be2d0584.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Victor Boussange</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Victor Boussange</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/studentprojects"><span>üî¨ Student projects</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#software"><span>üßëüèΩ‚Äçüíª Software</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#publications"><span>üìÑ Publications & Talks</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#teaching"><span>üéì Teaching & resources</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#posts"><span>üí¨ Posts</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>On combining machine learning-based and theoretical ecosystem models</h1>

  

  
    


<div class="article-metadata">

  
  
  
  
  <div>
    

  <span class="author-highlighted">
      Victor Boussange</span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Mar 31, 2023
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    14 min read
  </span>
  

  
  
  
  

  
  

</div>

    





  
</div>



  <div class="article-container">

    <div class="article-style">
      <p>In this post, I explore the benefits and drawbacks of using empirical (ML)-based models versus mechanistic models for predicting ecosystem responses to perturbations. To evaluate these different modelling approaches, I use a mechanistic ecosystem model to generate a synthetic time series dataset.</p>
<p>By applying both modelling approaches to this dataset, I can evaluate their performance. While the ML-based approach yields accurate forecasts under unperturbed dynamics, it inevitably fails when it comes to predicting ecosystem response to perturbations. On the other hand, the mechanistic model, which is simplified version of the ground truth model to reflect a realistic scenario, is inaccurate and cannot forecast, but provides a more adequate approach to predict ecosystem response to unobserved scenarios.</p>
<p>To improve the accuracy of mechanistic models, I introduce inverse modelling, and in particular an approach that I have developed called piecewise inference. This approach allows to accurately calibrate complex mechanistic models, and doing so open doors to improve our understanding ecosystems by performing model selection.</p>
<p>Finally, I discuss how hybrid models, which incorporate both ML-based and mechanistic components, offer the potential to benefit from the strengths of both modelling approaches. By examining the strengths and limitations of these different modelling approaches, I hope to provide insights into how best to use them to advance our knowledge of ecological and evolutionary dynamics.</p>
<h3 id="notes">Notes</h3>
<ul>
<li>This post is under construction, and contain typos! If you find some, please contact me so that I can correct</li>
<li>For the sake of clarity, some pieces of code have voluntarily been hidden in external Julia files, which are loaded throughout the post. If you want to inspect them, check out those files in <a href="https://github.com/vboussange/MyTutorials" target="_blank" rel="noopener">the corresponding GitHub repository</a></li>
</ul>
<h2 id="generating-a-synthetic-dataset">Generating a synthetic dataset</h2>
<p>To generate the synthetic dataset, I consider a 3 species ecosystem model, composed of a resource, consumer and prey species. The resource growth rate depends on water availability. Here is a simplified version of the dynamics</p>
<p>$$\begin{aligned}
\text{basal growth of } \text{üå±} &amp;= f(\text{üíß})\\
\text{per capita growth rate }\text{üå±} &amp;= \text{basal growth} - \text{competition} - \text{grazing} - \text{death}\\
\text{per capita growth rate  }\text{ü¶ì} &amp;= \text{grazing} - \text{predation} - \text{death}\\
\text{per capita growth rate  }\text{ü¶Å} &amp;= \text{predation} - \text{death}
\end{aligned}$$</p>
<p>Let&rsquo;s implement that in Julia!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">cd</span><span class="p">(</span><span class="nd">@__DIR__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="n">Pkg</span><span class="p">;</span> <span class="n">Pkg</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="s">&#34;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">PythonCall</span>
</span></span><span class="line"><span class="cl"><span class="n">nx</span> <span class="o">=</span> <span class="n">pyimport</span><span class="p">(</span><span class="s">&#34;networkx&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">np</span> <span class="o">=</span> <span class="n">pyimport</span><span class="p">(</span><span class="s">&#34;numpy&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">include</span><span class="p">(</span><span class="s">&#34;model.jl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">include</span><span class="p">(</span><span class="s">&#34;utils.jl&#34;</span><span class="p">);</span>
</span></span></code></pre></div><p>To implement the model, I use the library <a href="https://github.com/vboussange/EcoEvoModelZoo.jl" target="_blank" rel="noopener"><code>EcoEvoModelZoo</code></a>, which provides to the user ready-to-use mechanistic eco-evolutionary models. I use the model type <code>SimpleEcosystemModel</code>, cf. <a href="https://vboussange.github.io/EcoEvoModelZoo.jl/dev/#EcoEvoModelZoo.SimpleEcosystemModel" target="_blank" rel="noopener">documentation of EcoEvoModelZoo</a>. Let&rsquo;s first construct the trophic network, and plot it</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">EcoEvoModelZoo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">N</span> <span class="o">=</span> <span class="mi">3</span> <span class="c"># number of species</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pos</span> <span class="o">=</span> <span class="kt">Dict</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">labs</span> <span class="o">=</span> <span class="kt">Dict</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="s">&#34;Resource&#34;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="s">&#34;Consumer&#34;</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="s">&#34;Prey&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">foodweb</span> <span class="o">=</span> <span class="n">DiGraph</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">add_edge!</span><span class="p">(</span><span class="n">foodweb</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># Consumer (node 2) feeds on Resource (node 1)</span>
</span></span><span class="line"><span class="cl"><span class="n">add_edge!</span><span class="p">(</span><span class="n">foodweb</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="c"># Predator (node 3) fonds on consumer (node 2)</span>
</span></span><span class="line"><span class="cl"><span class="n">println</span><span class="p">(</span><span class="n">foodweb</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>Graphs.SimpleGraphs.SimpleDiGraph{Int64}(2, [Int64[], [1], [2]], [[2], [3],
 Int64[]])
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">plot_foodweb</span><span class="p">(</span><span class="n">foodweb</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labs</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>(&lt;py Figure size 640x480 with 1 Axes&gt;, &lt;py Axes: &gt;)
</code></pre>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_3_1_hu769f3503b0f9bf80982a28ac87f9203e_15834_0961d33d4ace963a383bfd5dc7cd1871.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_3_1_hu769f3503b0f9bf80982a28ac87f9203e_15834_5ccf0272854b3c6a20997d64ca67ab29.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_3_1_hu769f3503b0f9bf80982a28ac87f9203e_15834_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_3_1_hu769f3503b0f9bf80982a28ac87f9203e_15834_0961d33d4ace963a383bfd5dc7cd1871.webp"
               width="515"
               height="389"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<p>Then, I implement the processes that drive the dynamics of the ecoystem. Those include resource limitation for the resource species (e.g. limitation in nutrients), intraspecific competition for the resource species, reproduction, and feeding interactions (grazing and predation). To better understand this piece of code, you may want to refer to one of my previous blog post, <a href="https://vboussange.github.io/post/piecewiseinference/" target="_blank" rel="noopener">&ldquo;Inverse ecosystem modelling made easy with PiecewiseInference.jl&rdquo;</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="k">function</span> <span class="n">carrying_capacity</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@unpack</span> <span class="n">K‚ÇÅ‚ÇÅ</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">    <span class="n">K</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="n">K‚ÇÅ‚ÇÅ</span><span class="p">,</span> <span class="n">ones</span><span class="p">(</span><span class="kt">Float32</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><pre tabindex="0"><code>carrying_capacity (generic function with 1 method)
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="k">function</span> <span class="n">competition</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@unpack</span> <span class="n">A‚ÇÅ‚ÇÅ</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">    <span class="n">A</span> <span class="o">=</span> <span class="n">spdiagm</span><span class="p">(</span><span class="n">vcat</span><span class="p">(</span><span class="n">A‚ÇÅ‚ÇÅ</span><span class="p">,</span> <span class="n">zeros</span><span class="p">(</span><span class="kt">Float32</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">u</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><pre tabindex="0"><code>competition (generic function with 1 method)
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">resource_conversion_efficiency</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="kt">Float32</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>resource_conversion_efficiency (generic function with 1 method)
</code></pre><h4 id="functional-responses">Functional responses</h4>
<p>The feeding processes implemented are based on a functional response of type II. The attack rates <code>q</code> define the slope of the functional response, while the handling times <code>H</code> define the saturation of this response.</p>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/af/FunctionalResponsesGraph.svg/1024px-FunctionalResponsesGraph.svg.png" width="500"/>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">W</span> <span class="o">=</span> <span class="n">adjacency_matrix</span><span class="p">(</span><span class="n">foodweb</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">findnz</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="n">feeding</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@unpack</span> <span class="n">H‚ÇÇ‚ÇÅ</span><span class="p">,</span> <span class="n">H‚ÇÉ‚ÇÇ</span><span class="p">,</span> <span class="n">q‚ÇÇ‚ÇÅ</span><span class="p">,</span> <span class="n">q‚ÇÉ‚ÇÇ</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c"># handling time</span>
</span></span><span class="line"><span class="cl">    <span class="n">H</span> <span class="o">=</span> <span class="n">sparse</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">vcat</span><span class="p">(</span><span class="n">H‚ÇÇ‚ÇÅ</span><span class="p">,</span> <span class="n">H‚ÇÉ‚ÇÇ</span><span class="p">),</span> <span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c"># attack rates</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="o">=</span> <span class="n">sparse</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">vcat</span><span class="p">(</span><span class="n">q‚ÇÇ‚ÇÅ</span><span class="p">,</span> <span class="n">q‚ÇÉ‚ÇÇ</span><span class="p">),</span> <span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">q</span> <span class="o">.*</span> <span class="n">W</span> <span class="o">./</span> <span class="p">(</span><span class="n">one</span><span class="p">(</span><span class="n">eltype</span><span class="p">(</span><span class="n">u</span><span class="p">))</span> <span class="o">.+</span> <span class="n">q</span> <span class="o">.*</span> <span class="n">H</span> <span class="o">.*</span> <span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="n">u</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><pre tabindex="0"><code>feeding (generic function with 1 method)
</code></pre><h4 id="dependence-of-resource-growth-rate-on-water-availability">Dependence of resource growth rate on water availability</h4>
<p>We model a time-varying water availability, and a growth rate of the resource which depends on the water availability.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">water_availability</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="n">sin</span><span class="o">.</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">pi</span> <span class="o">/</span> <span class="mi">600</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">growth_rate_resource</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">water</span><span class="p">)</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">water</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">intinsic_growth_rate</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">growth_rate_resource</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">water_availability</span><span class="p">(</span><span class="n">t</span><span class="p">));</span> <span class="n">p</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]]</span>
</span></span></code></pre></div><pre tabindex="0"><code>intinsic_growth_rate (generic function with 1 method)
</code></pre><p>Let&rsquo;s plot what does the water availability looks like through time</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">ts</span> <span class="o">=</span> <span class="n">tspan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="n">tspan</span><span class="p">[</span><span class="k">end</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">water_availability</span><span class="o">.</span><span class="p">(</span><span class="n">ts</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">xlabel</span><span class="p">(</span><span class="s">&#34;Time (days)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ylabel</span><span class="p">(</span><span class="s">&#34;Water availability (normalized)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>Python None
</code></pre><p>Now we define the numerical values for the parameter of the ecosystem model.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">p_true</span> <span class="o">=</span> <span class="n">ComponentArray</span><span class="p">(</span><span class="n">H‚ÇÇ‚ÇÅ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">1.24</span><span class="p">],</span> <span class="c"># handling times</span>
</span></span><span class="line"><span class="cl">                        <span class="n">H‚ÇÉ‚ÇÇ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">2.5</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">q‚ÇÇ‚ÇÅ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">4.98</span><span class="p">],</span> <span class="c"># attack rates</span>
</span></span><span class="line"><span class="cl">                        <span class="n">q‚ÇÉ‚ÇÇ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">0.8</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">r</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08</span><span class="p">],</span> <span class="c"># growth rates</span>
</span></span><span class="line"><span class="cl">                        <span class="n">K‚ÇÅ‚ÇÅ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="c"># carrying capacity for the resource</span>
</span></span><span class="line"><span class="cl">                        <span class="n">A‚ÇÅ‚ÇÅ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">1.0</span><span class="p">])</span> <span class="c"># competition for the resource</span>
</span></span></code></pre></div><pre tabindex="0"><code>ComponentVector{Float32}(H‚ÇÇ‚ÇÅ = Float32[1.24], H‚ÇÉ‚ÇÇ = Float32[2.5], q‚ÇÇ‚ÇÅ = Flo
at32[4.98], q‚ÇÉ‚ÇÇ = Float32[0.8], r = Float32[1.0, -0.4, -0.08], K‚ÇÅ‚ÇÅ = Float3
2[1.0], A‚ÇÅ‚ÇÅ = Float32[1.0])
</code></pre><p>And with that, we can plot how we implemented the dependence between the resource growth rate and the water availability. It is a gaussian dependence, where the resource growth rate is maximum at a certain value of water availability. The intuition is that too much or too little water is detrimental to the resource.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">water_avail_range</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span><span class="n">sort!</span><span class="p">(</span><span class="n">water_availability</span><span class="o">.</span><span class="p">(</span><span class="n">tsteps</span><span class="p">)),</span><span class="n">length</span><span class="p">(</span><span class="n">tsteps</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plot</span><span class="p">(</span><span class="n">water_avail_range</span><span class="p">,</span> <span class="n">growth_rate_resource</span><span class="o">.</span><span class="p">(</span><span class="n">p_true</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">water_avail_range</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">xlabel</span><span class="p">(</span><span class="s">&#34;Water availability (normalized)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ylabel</span><span class="p">(</span><span class="s">&#34;Resource basal growth rate&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;none&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>Python None
</code></pre><p>Now let&rsquo;s simulate the dynamics</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">u0_true</span> <span class="o">=</span> <span class="kt">Float32</span><span class="p">[</span><span class="mf">0.77</span><span class="p">,</span> <span class="mf">0.060</span><span class="p">,</span> <span class="mf">0.945</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mp</span> <span class="o">=</span> <span class="n">ModelParams</span><span class="p">(;</span><span class="n">p</span><span class="o">=</span><span class="n">p_true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">tspan</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">u0</span><span class="o">=</span><span class="n">u0_true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">solve_params</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">SimpleEcosystemModel</span><span class="p">(;</span> 
</span></span><span class="line"><span class="cl">                            <span class="n">mp</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                            <span class="n">intinsic_growth_rate</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">carrying_capacity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">competition</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">resource_conversion_efficiency</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">feeding</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>`Model` SimpleEcosystemModel
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_time_series</span><span class="p">(</span><span class="n">simulate</span><span class="p">(</span><span class="n">model</span><span class="p">));</span>
</span></span></code></pre></div>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_13_1_hu2ce747f474517ad4a29196c23aae94cb_56208_aaad81cbc52fbb486f86e5709a30009f.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_13_1_hu2ce747f474517ad4a29196c23aae94cb_56208_989a6804e6a3bb69bb1d54d965c76b80.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_13_1_hu2ce747f474517ad4a29196c23aae94cb_56208_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_13_1_hu2ce747f474517ad4a29196c23aae94cb_56208_aaad81cbc52fbb486f86e5709a30009f.webp"
               width="676"
               height="412"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<p>And let&rsquo;s generate a dataset by contaminating the model output with lognormally distributed noise.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="kt">Array</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># contaminating raw data with noise</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">.*</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="mf">1f-1</span><span class="o">*</span><span class="n">randn</span><span class="p">(</span><span class="kt">Float32</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># plotting</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">:</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels_sp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="c"># ax.set_yscale(&#34;log&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#34;Species abundance&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#34;Time (days)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span></span></code></pre></div>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_14_1_hu049d97853d356388ff8ca81f727fb321_26102_34917f32e8be0d352e158250dfce8fa4.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_14_1_hu049d97853d356388ff8ca81f727fb321_26102_44fa4ddc1c2c5457d2b95b948e4b578d.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_14_1_hu049d97853d356388ff8ca81f727fb321_26102_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_14_1_hu049d97853d356388ff8ca81f727fb321_26102_34917f32e8be0d352e158250dfce8fa4.webp"
               width="676"
               height="412"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<h2 id="empirical-modelling">Empirical modelling</h2>
<p>Let&rsquo;s build a ML-model, and train the model on the time series.</p>
<p>We&rsquo;ll use a recurrent neural network model</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b5/Recurrent_neural_network_unfold.svg/1280px-Recurrent_neural_network_unfold.svg.png" alt="" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>More specifically, we use a Long Short Term Memory cell, connected to two dense layers with <code>relu</code> and a radial basis  (<code>rbf</code>) activation functions.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">Flux</span> <span class="c"># Julia deep learning library</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">include</span><span class="p">(</span><span class="s">&#34;rnn.jl&#34;</span><span class="p">)</span> <span class="c"># Load some utility functions</span>
</span></span><span class="line"><span class="cl"><span class="n">args</span> <span class="o">=</span> <span class="n">ArgsEco</span><span class="p">()</span> <span class="c"># Set up hyperparameters</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rbf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="p">))</span> <span class="c"># custom activation function</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">hls</span> <span class="o">=</span> <span class="mi">64</span> <span class="c"># hidden layer size</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Definition of the RNN</span>
</span></span><span class="line"><span class="cl"><span class="c"># our model takes in the ecosystem state variables, together with current water availability</span>
</span></span><span class="line"><span class="cl"><span class="n">rnn_model</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hls</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">Flux</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">hls</span><span class="p">,</span> <span class="n">hls</span><span class="p">,</span> <span class="n">relu</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">Flux</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">hls</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">rbf</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@time</span> <span class="n">train_model!</span><span class="p">(</span><span class="n">rnn_model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>   <span class="c"># Train and output model</span>
</span></span></code></pre></div><pre tabindex="0"><code>75.555727 seconds (137.67 M allocations: 50.030 GiB, 6.62% gc time, 37.42%
 compilation time)
</code></pre><p>We can now simulate our trained model in an autoregressive manner, which allows us to forecast over time steps beyond the training dataset.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">tsteps_forecast</span> <span class="o">=</span> <span class="n">tspan</span><span class="p">[</span><span class="k">end</span><span class="p">]</span><span class="o">+</span><span class="n">dt</span><span class="o">:</span><span class="n">dt</span><span class="ss">:tspan</span><span class="p">[</span><span class="k">end</span><span class="p">]</span><span class="o">+</span><span class="mi">100</span><span class="o">*</span><span class="n">dt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">water_availability_range</span> <span class="o">=</span> <span class="n">water_availability</span><span class="o">.</span><span class="p">(</span><span class="n">vcat</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span> <span class="n">tsteps_forecast</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">init_states</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pred_rnn</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">rnn_model</span><span class="p">,</span> <span class="n">init_states</span><span class="p">,</span> <span class="n">water_availability_range</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>3√ó200 Matrix{Float32}:
 0.762119  0.808972   0.814921   0.789933   ‚Ä¶  0.871319  0.816685  0.742632
 0.118674  0.0965346  0.0672258  0.0434324     0.119743  0.14609   0.185878
 0.530488  0.531594   0.518911   0.476789      0.301607  0.29676   0.31418
</code></pre><p>And let&rsquo;s plot it. Plain lines are the model output for the training time span, and dashed lines are the model forecast.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">N</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tsteps</span><span class="p">[</span><span class="mi">3</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                <span class="n">label</span> <span class="o">=</span> <span class="n">labels_sp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                <span class="n">color</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="o">=</span> <span class="mf">6.</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">            <span class="n">pred_rnn</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">tsteps</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps_forecast</span> <span class="o">.+</span> <span class="n">dt</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">pred_rnn</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">length</span><span class="p">(</span><span class="n">tsteps</span><span class="p">)</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">            <span class="n">linestyle</span><span class="o">=</span><span class="s">&#34;--&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#34;Species abundance&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#34;Time (days)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span></span></code></pre></div>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_17_1_hu26e1ff11e70775d4e35c1ec109df391d_78419_f939481363f74be53211048c7333d960.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_17_1_hu26e1ff11e70775d4e35c1ec109df391d_78419_14968329e3e7ab87f3b46161434c2459.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_17_1_hu26e1ff11e70775d4e35c1ec109df391d_78419_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_17_1_hu26e1ff11e70775d4e35c1ec109df391d_78419_f939481363f74be53211048c7333d960.webp"
               width="676"
               height="412"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<p>Looks pretty good!</p>
<p>Now let&rsquo;s see what happens if the resource species go extinct. Because this species is at the bottom of the trophic chain, we expect a collapse of the ecosystem.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">water_availability_range</span> <span class="o">=</span> <span class="n">water_availability</span><span class="o">.</span><span class="p">(</span><span class="n">tsteps</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">init_states</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">init_states</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span> <span class="o">.=</span> <span class="mf">0.</span>
</span></span><span class="line"><span class="cl"><span class="n">pred_rnn</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">rnn_model</span><span class="p">,</span> <span class="n">init_states</span><span class="p">,</span> <span class="n">water_availability_range</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>3√ó100 Matrix{Float32}:
 0.904891   0.767216   0.741785   0.774109  ‚Ä¶  0.183886  0.0288432  0.04645
4
 0.0890969  0.0426226  0.0287545  0.019797     0.596416  0.293802   0.08636
74
 0.59085    0.542144   0.487364   0.441334     0.178284  0.282761   0.29444
7
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">N</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">            <span class="n">pred_rnn</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="o">:</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#34;Species abundance&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#34;Time (days)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span></span></code></pre></div>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_19_1_hu1d1e8ebdc6caa67a1f91675e4046a75f_48581_b359a9096325b4760cb0780d650b66fa.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_19_1_hu1d1e8ebdc6caa67a1f91675e4046a75f_48581_4846f46967855ebd1620d2aeaa37e648.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_19_1_hu1d1e8ebdc6caa67a1f91675e4046a75f_48581_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_19_1_hu1d1e8ebdc6caa67a1f91675e4046a75f_48581_b359a9096325b4760cb0780d650b66fa.webp"
               width="613"
               height="371"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<p>There is clearly a problem! The RNN model outputs almost unchanged dynamics, predicting that magically, the resource would revive. This were to be expected: the ML model did not see this type of collapse dynamics, so it cannot invent it.</p>
<p>In summary, ML-based model</p>
<ul>
<li>üëç Very good for interpolation</li>
<li>üëç Does not require any knowledge from the system, only data!</li>
<li>üëé Cannot extrapolate to unobserved scenarios</li>
</ul>
<h2 id="mechanistic-modelling">Mechanistic modelling</h2>
<p>We now define a new mechanistic model, deliberatively falsifying the numerical value of the parameters compared to the baseline ecosystem model, and simplifying the resource dependence on water availbility by assuming that its growth rate is constant. The resulting <code>model_mechanistic</code> is as such an inaccurate representation of the baseline ecosystem model.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">p_mech</span> <span class="o">=</span> <span class="n">ComponentArray</span><span class="p">(</span><span class="n">H‚ÇÇ‚ÇÅ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">1.1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">H‚ÇÉ‚ÇÇ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">2.3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">q‚ÇÇ‚ÇÅ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">4.98</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">q‚ÇÉ‚ÇÇ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">0.8</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">r</span> <span class="o">=</span> <span class="kt">Float32</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">K‚ÇÅ‚ÇÅ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">0.8</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">A‚ÇÅ‚ÇÅ</span><span class="o">=</span><span class="kt">Float32</span><span class="p">[</span><span class="mf">1.2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">u0_mech</span> <span class="o">=</span> <span class="kt">Float32</span><span class="p">[</span><span class="mf">0.77</span><span class="p">,</span> <span class="mf">0.060</span><span class="p">,</span> <span class="mf">0.945</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mp</span> <span class="o">=</span> <span class="n">ModelParams</span><span class="p">(;</span> <span class="n">p</span><span class="o">=</span><span class="n">p_mech</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">u0</span><span class="o">=</span><span class="n">u0_mech</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">solve_params</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">growth_rate_mech</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">model_mechanistic</span> <span class="o">=</span> <span class="n">SimpleEcosystemModel</span><span class="p">(;</span> <span class="n">mp</span><span class="p">,</span> <span class="n">intinsic_growth_rate</span> <span class="o">=</span> <span class="n">growth_rate_mech</span> <span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">carrying_capacity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">competition</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">resource_conversion_efficiency</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">feeding</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">simul_data</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">model_mechanistic</span><span class="p">)</span>
</span></span></code></pre></div><p>Let&rsquo;s now plot its dynamics</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">plot_time_series</span><span class="p">(</span><span class="n">simul_data</span><span class="p">);</span>
</span></span></code></pre></div>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_21_1_huca332ffd300a6a09c7cf118c489cd565_51842_c8358bc28e81bc2f50c60498516d5083.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_21_1_huca332ffd300a6a09c7cf118c489cd565_51842_1e7d47d01abd3b4b2b6ae229b5fc83e8.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_21_1_huca332ffd300a6a09c7cf118c489cd565_51842_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_21_1_huca332ffd300a6a09c7cf118c489cd565_51842_c8358bc28e81bc2f50c60498516d5083.webp"
               width="676"
               height="412"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<p>The dynamics looks quite different from the time series, and cannot provide any realistic forecast of the ecosystem state in the future. Yet, it does capture some of the dynamics, since it reproduces an oscillatory behavior. As such, we can assume that this ecosystem model captures some of the processes driving the baseline ecosystem dynamics.</p>
<p>We can now use this mechanistic model to again try to understand what happens if the resource species go extinct.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">simul_data</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">model_mechanistic</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="n">u0</span> <span class="o">=</span> <span class="kt">Float32</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.060</span><span class="p">,</span> <span class="mf">0.945</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                <span class="n">saveat</span><span class="o">=</span><span class="mi">0</span><span class="o">:</span><span class="n">dt</span><span class="o">:</span><span class="mf">100.</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plot_time_series</span><span class="p">(</span><span class="n">simul_data</span><span class="p">);</span>
</span></span></code></pre></div>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_22_1_hu0c9d8547eb872fd14161d7611eb7a316_20131_12eef56680d1d3f431057c78221ce06d.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_22_1_hu0c9d8547eb872fd14161d7611eb7a316_20131_7195be7be5a58fccc412047c2eec1d78.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_22_1_hu0c9d8547eb872fd14161d7611eb7a316_20131_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_22_1_hu0c9d8547eb872fd14161d7611eb7a316_20131_12eef56680d1d3f431057c78221ce06d.webp"
               width="676"
               height="412"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<p>That makes much more sense!!! The model does predict a collapse, and we can even estimate how long it will take for the system to fully collapse.</p>
<p>In summary, mechanistic models</p>
<ul>
<li>üëç Very good for extrapolating to novel scenarios</li>
<li>üëé Hard to parametrise</li>
<li>üëé Inacurate</li>
</ul>
<p>Now let&rsquo;s see how we can improve this ecosystem model, by making better use of the dataset that we have at hand.</p>
<h2 id="inverse-modelling">Inverse modelling</h2>
<p><strong>Use the observed data to infer the parameters of a model</strong></p>
<p>There are two broad classes of methods to perform inverse modelling:</p>
<ul>
<li>
<p><strong>Bayesian inference</strong></p>
<ul>
<li>provide <strong>uncertainties estimations</strong></li>
<li>does not scale well with the number of parameters to explore</li>
</ul>
</li>
<li>
<p><strong>Variational optimization</strong></p>
<ul>
<li>Does not suffer from the curse of dimensionality</li>
<li>Convergence to local minima</li>
<li>Need for parameter sensitivity</li>
</ul>
</li>
</ul>
<p>To better understand the caveats of the variational optimization approach, let&rsquo;s further explain it. This method consists in defining a certain loss function, which allows to measure a distance between the model output and the observations:</p>
<p>$$
\text{L} = \sum_i [\text{observations} - \text{simulations}]^2
$$</p>
<p>Variational optimization methods seek to minimize $L$ by using its gradient (sensitivity) with respect to the model parameters. This gradient indicates how to update the parameters to reduce the distance between the observations and the simulation outputs.</p>
<p>This can be done iteratively until finding the parameters that minimize the loss, as illustrated below.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="https://upload.wikimedia.org/wikipedia/commons/a/a3/Gradient_descent.gif?20190425084312" alt="" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>This works very well! In theory.</p>
<p>In practice, the landscape is rugged, as in the picture below</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/img/2d_landscape_rugged_hud3c37c92795a79e0fad7f22fdee08dd4_1594518_d4de5aa1f5493a6921b1e3d2dbb05100.webp 400w,
               /post/hybridmodelling/img/2d_landscape_rugged_hud3c37c92795a79e0fad7f22fdee08dd4_1594518_039b6c008f7389a879b09dda5ad6ded0.webp 760w,
               /post/hybridmodelling/img/2d_landscape_rugged_hud3c37c92795a79e0fad7f22fdee08dd4_1594518_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/img/2d_landscape_rugged_hud3c37c92795a79e0fad7f22fdee08dd4_1594518_d4de5aa1f5493a6921b1e3d2dbb05100.webp"
               width="760"
               height="570"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>By following the gradient in such a landscape, variational optimization methods tend to get stuck in wrong regions of the parameter space, and provide false estimate.</p>
<h3 id="piecewiseinferencejl">PiecewiseInference.jl</h3>
<p><a href="https://github.com/vboussange/PiecewiseInference.jl" target="_blank" rel="noopener">PiecewiseInference.jl</a> is a julia package that I have authored, which implements a method to smoothen the loss landscape, and that permits to automatically obtain the model parameter sensitivity. It is detailed in the following preprint</p>
<blockquote>
<p><del>Boussange, V., Vilimelis-Aceituno, P., Pellissier, L., Mini-batching ecological data to improve ecosystem models with machine learning. <a href="https://www.biorxiv.org/content/10.1101/2022.07.25.501365v1" target="_blank" rel="noopener">bioRxiv</a> (2022), 46 pages.</del></p>
</blockquote>
<p>‚ö†Ô∏è We will shortly rename this preprint in a revised version, as the term &ldquo;mini batching&rdquo; is confusing. We now prefer the term &ldquo;partitioning&rdquo;</p>
<p>The method works by training the model on small chunks of data</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/img/loss2_hu97c063a213f1b37c1b285dd0c25ee9a8_215058_1befb23583e8ac385b0d7e7bfca17961.webp 400w,
               /post/hybridmodelling/img/loss2_hu97c063a213f1b37c1b285dd0c25ee9a8_215058_30d9d1f40e1cbe40880ef3bbf2e79b18.webp 760w,
               /post/hybridmodelling/img/loss2_hu97c063a213f1b37c1b285dd0c25ee9a8_215058_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/img/loss2_hu97c063a213f1b37c1b285dd0c25ee9a8_215058_1befb23583e8ac385b0d7e7bfca17961.webp"
               width="760"
               height="346"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Let&rsquo;s use it to tune the paramters of our mechanitic model. We&rsquo;ll group data points in groups of 11, indicated by the argument <code>group_size = 11</code></p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/img/land_derugged_hu462ae4179d918234fd245a206e89159b_361794_122dd71f2d0efe31c5859f9d0942f604.webp 400w,
               /post/hybridmodelling/img/land_derugged_hu462ae4179d918234fd245a206e89159b_361794_3663b5376dbd88bb0062246030a7ae18.webp 760w,
               /post/hybridmodelling/img/land_derugged_hu462ae4179d918234fd245a206e89159b_361794_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/img/land_derugged_hu462ae4179d918234fd245a206e89159b_361794_122dd71f2d0efe31c5859f9d0942f604.webp"
               width="760"
               height="346"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">PiecewiseInference</span>
</span></span><span class="line"><span class="cl"><span class="n">include</span><span class="p">(</span><span class="s">&#34;utils.jl&#34;</span><span class="p">);</span> <span class="c"># some utility functions defining `inference_problem_args` and `piecewise_MLE_args`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">loss_likelihood</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">rg</span><span class="p">)</span> <span class="o">=</span> <span class="n">sum</span><span class="p">((</span><span class="n">log</span><span class="o">.</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">.-</span> <span class="n">log</span><span class="o">.</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">infprob</span> <span class="o">=</span> <span class="n">InferenceProblem</span><span class="p">(</span><span class="n">model_mechanistic</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                            <span class="n">p_mech</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">                            <span class="n">loss_likelihood</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                            <span class="n">inference_problem_args</span><span class="o">...</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@time</span> <span class="n">res_mech</span> <span class="o">=</span> <span class="n">piecewise_MLE</span><span class="p">(</span><span class="n">infprob</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                        <span class="n">group_size</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">tsteps</span> <span class="o">=</span> <span class="n">tsteps</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">optimizers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Adam</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">epochs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">piecewise_MLE_args</span><span class="o">...</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>piecewise_MLE with 101 points and 10 groups.
Current loss after 50 iterations: 14.972400665283203
Current loss after 100 iterations: 12.230918884277344
Current loss after 150 iterations: 11.497014045715332
Current loss after 200 iterations: 11.264657020568848
Current loss after 250 iterations: 11.19422721862793
Current loss after 300 iterations: 11.16870403289795
Current loss after 350 iterations: 11.156006813049316
Current loss after 400 iterations: 11.14731216430664
Current loss after 450 iterations: 11.141851425170898
Current loss after 500 iterations: 11.138410568237305
166.285066 seconds (1.17 G allocations: 177.010 GiB, 10.44% gc time, 27.02%
 compilation time: 0% of which was recompilation)
`InferenceResult` with model SimpleEcosystemModel
</code></pre><p>Now let&rsquo;s plot what does this trained model predicts</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">simul_mech_forecast</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">model_mechanistic</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                <span class="n">p</span> <span class="o">=</span> <span class="n">res_mech</span><span class="o">.</span><span class="n">p_trained</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                <span class="n">u0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                                <span class="n">saveat</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span> <span class="n">tsteps_forecast</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                <span class="n">tspan</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tsteps_forecast</span><span class="p">[</span><span class="k">end</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">N</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="o">:</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                <span class="n">label</span> <span class="o">=</span> <span class="n">labels_sp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                <span class="n">color</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="o">=</span> <span class="mf">6.</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">            <span class="n">simul_mech_forecast</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">tsteps</span><span class="p">)],</span> 
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps_forecast</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">simul_mech_forecast</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">length</span><span class="p">(</span><span class="n">tsteps</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">            <span class="n">linestyle</span><span class="o">=</span><span class="s">&#34;--&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#34;Species abundance&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#34;Time (days)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span></span></code></pre></div>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_24_1_huefae2b126016c917f2b90ccf39ce12fa_75001_cf17daabf110b549268fdf7811dd8d35.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_24_1_huefae2b126016c917f2b90ccf39ce12fa_75001_41d4b04e2c5436358cf5b2d39f3d4065.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_24_1_huefae2b126016c917f2b90ccf39ce12fa_75001_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_24_1_huefae2b126016c917f2b90ccf39ce12fa_75001_cf17daabf110b549268fdf7811dd8d35.webp"
               width="676"
               height="412"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<p>Looks much better! The model now captures doubling period oscillations.</p>
<p>In summary, mechanistic models</p>
<ul>
<li>üëç Very good for extrapolating to novel scenarios</li>
<li>üëé <del>Hard to parametrise</del></li>
<li>üëé Inacurate</li>
</ul>
<h3 id="model-selection">Model selection</h3>
<p>To improve the accuracy, one can try to formulate different models corresponding to alternative hypotheses about the processes driving the ecosystem dynamics. For instance, we could compare the performance of this model to an alternative model, which would capture some sort of dependence between the water availability and the resource growth rate.</p>
<p>If we find that the refined model performs better than the model with constant growth rate, we have learnt that water availability is an important driver that affects the ecosystem dynamics.</p>
<h2 id="hybrid-models">Hybrid models</h2>
<p>Assume that we have no idea on what the dependence of the resource growth rate on water availability may look like.</p>
<p>To proceed, we can define a very generic parametric function that can capture any sort of dependence, and then try to learn the parameters of this function from the data.</p>
<p>Neural networks are parametric functions that are highly suited for this sort of task. So we&rsquo;ll build a hyrbid model, which contains the mechanistic components of the previous model, but where the resource growth rate is parametrized by a neural network.</p>
<h3 id="---">ü§ñ + üî¨= ü§Ø</h3>
<p>Below, we define the neural network, and the resource growth rate based on this neural net.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">Lux</span>
</span></span><span class="line"><span class="cl"><span class="n">rng</span> <span class="o">=</span> <span class="n">Random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c"># Multilayer FeedForward</span>
</span></span><span class="line"><span class="cl"><span class="n">hlsize</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">neural_net</span> <span class="o">=</span> <span class="n">Lux</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span><span class="n">Lux</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">hlsize</span><span class="p">,</span><span class="n">rbf</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                        <span class="n">Lux</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">hlsize</span><span class="p">,</span><span class="n">hlsize</span><span class="p">,</span> <span class="n">rbf</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                        <span class="n">Lux</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">hlsize</span><span class="p">,</span><span class="n">hlsize</span><span class="p">,</span> <span class="n">rbf</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                        <span class="n">Lux</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">hlsize</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c"># Get the initial parameters and state variables of the model</span>
</span></span><span class="line"><span class="cl"><span class="n">p_nn</span><span class="p">,</span> <span class="n">st</span> <span class="o">=</span> <span class="n">Lux</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">neural_net</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p_nn</span> <span class="o">=</span> <span class="n">p_nn</span> <span class="o">|&gt;</span> <span class="n">ComponentArray</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">growth_rate_resource_nn</span><span class="p">(</span><span class="n">p_nn</span><span class="p">,</span> <span class="n">water</span><span class="p">)</span> <span class="o">=</span> <span class="n">neural_net</span><span class="p">([</span><span class="n">water</span><span class="p">],</span> <span class="n">p_nn</span><span class="p">,</span> <span class="n">st</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="n">hybrid_growth_rate</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="n">growth_rate_resource_nn</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">p_nn</span><span class="p">,</span> <span class="n">water_availability</span><span class="p">(</span><span class="n">t</span><span class="p">));</span> <span class="n">p</span><span class="o">.</span><span class="n">r</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><pre tabindex="0"><code>hybrid_growth_rate (generic function with 1 method)
</code></pre><p>Now we define our new hybrid model that implements this <code>hybrid_growth_rate</code> function</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">p_hybr</span> <span class="o">=</span> <span class="n">ComponentArray</span><span class="p">(</span><span class="n">H‚ÇÇ‚ÇÅ</span><span class="o">=</span><span class="n">p_mech</span><span class="o">.</span><span class="n">H‚ÇÇ‚ÇÅ</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">H‚ÇÉ‚ÇÇ</span><span class="o">=</span><span class="n">p_mech</span><span class="o">.</span><span class="n">H‚ÇÉ‚ÇÇ</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">q‚ÇÇ‚ÇÅ</span><span class="o">=</span><span class="n">p_mech</span><span class="o">.</span><span class="n">q‚ÇÇ‚ÇÅ</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">q‚ÇÉ‚ÇÇ</span><span class="o">=</span><span class="n">p_mech</span><span class="o">.</span><span class="n">q‚ÇÉ‚ÇÇ</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">r</span> <span class="o">=</span> <span class="n">p_mech</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">K‚ÇÅ‚ÇÅ</span><span class="o">=</span><span class="n">p_mech</span><span class="o">.</span><span class="n">K‚ÇÅ‚ÇÅ</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">A‚ÇÅ‚ÇÅ</span><span class="o">=</span><span class="n">p_mech</span><span class="o">.</span><span class="n">A‚ÇÅ‚ÇÅ</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">p_nn</span> <span class="o">=</span> <span class="n">p_nn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mp</span> <span class="o">=</span> <span class="n">ModelParams</span><span class="p">(;</span><span class="n">p</span><span class="o">=</span><span class="n">p_hybr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">u0</span><span class="o">=</span><span class="n">u0_mech</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">solve_params</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">model_hybrid</span> <span class="o">=</span> <span class="n">SimpleEcosystemModel</span><span class="p">(;</span> <span class="n">mp</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                    <span class="n">intinsic_growth_rate</span> <span class="o">=</span> <span class="n">hybrid_growth_rate</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="n">carrying_capacity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="n">competition</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="n">resource_conversion_efficiency</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="n">feeding</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>`Model` SimpleEcosystemModel
</code></pre><p>And we train it</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">infprob</span> <span class="o">=</span> <span class="n">InferenceProblem</span><span class="p">(</span><span class="n">model_hybrid</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                            <span class="n">p_hybr</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">                            <span class="n">loss_likelihood</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                            <span class="n">inference_problem_args</span><span class="o">...</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">res_hybr</span> <span class="o">=</span> <span class="n">piecewise_MLE</span><span class="p">(</span><span class="n">infprob</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">group_size</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">tsteps</span> <span class="o">=</span> <span class="n">tsteps</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">optimizers</span> <span class="o">=</span> <span class="p">[</span><span class="n">Adam</span><span class="p">(</span><span class="mf">2e-2</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">                    <span class="n">epochs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="n">piecewise_MLE_args</span><span class="o">...</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>piecewise_MLE with 101 points and 10 groups.
Current loss after 50 iterations: 5.201906204223633
Current loss after 100 iterations: 3.6290767192840576
Current loss after 150 iterations: 3.519521713256836
Current loss after 200 iterations: 3.4955437183380127
Current loss after 250 iterations: 3.4787349700927734
Current loss after 300 iterations: 3.5343759059906006
Current loss after 350 iterations: 3.4698166847229004
Current loss after 400 iterations: 3.4563584327697754
Current loss after 450 iterations: 3.5980613231658936
Current loss after 500 iterations: 3.4506189823150635
`InferenceResult` with model SimpleEcosystemModel
</code></pre><p>The loss has signficiantly reduced. This means that this model better explains the dynamics, and as such, we have discovered that water avilability is indeed an important driver of ecosystem dynamics! Let&rsquo;s plot the simulation output of this hyrbid model</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">simul_hybr_forecast</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">model_hybrid</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                <span class="n">p</span> <span class="o">=</span> <span class="n">res_hybr</span><span class="o">.</span><span class="n">p_trained</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl"><span class="c">#                                 u0 = res_hybr.u0s_trained[1],</span>
</span></span><span class="line"><span class="cl">                                <span class="n">u0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                                <span class="n">saveat</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span> <span class="n">tsteps_forecast</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                <span class="n">tspan</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tsteps_forecast</span><span class="p">[</span><span class="k">end</span><span class="p">]));</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">N</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="o">:</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                <span class="n">label</span> <span class="o">=</span> <span class="n">labels_sp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                <span class="n">color</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="o">=</span> <span class="mf">6.</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">        <span class="n">simul_hybr_forecast</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">tsteps</span><span class="p">)],</span> 
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps_forecast</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">simul_hybr_forecast</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">length</span><span class="p">(</span><span class="n">tsteps</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">            <span class="n">linestyle</span><span class="o">=</span><span class="s">&#34;--&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">species_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#34;Species abundance&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#34;Time (days)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">&#34;None&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span></span></code></pre></div>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_29_1_huc30c13b64e982855db042c5771a0a0b5_81386_7e14682c303a81defaadb4e822c57ce5.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_29_1_huc30c13b64e982855db042c5771a0a0b5_81386_915262d4977910389733a5e82ac9efdb.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_29_1_huc30c13b64e982855db042c5771a0a0b5_81386_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_29_1_huc30c13b64e982855db042c5771a0a0b5_81386_7e14682c303a81defaadb4e822c57ce5.webp"
               width="676"
               height="412"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<p>The cool thing is that although it contains a fully parametric component (the neural network), this hybrid can still extrapolate, because it is constrained by mechanistic processes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">plot_time_series</span><span class="p">(</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_hybrid</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="n">p</span> <span class="o">=</span> <span class="n">res_hybr</span><span class="o">.</span><span class="n">p_trained</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="n">u0</span> <span class="o">=</span> <span class="kt">Float32</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.060</span><span class="p">,</span> <span class="mf">0.945</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                <span class="n">saveat</span><span class="o">=</span><span class="mi">0</span><span class="o">:</span><span class="n">dt</span><span class="o">:</span><span class="mf">100.</span><span class="p">));</span>
</span></span></code></pre></div>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_30_1_hu1a10456908d959c33577820c29b84e06_19920_34bfc6e0e7840b928b16c117155700df.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_30_1_hu1a10456908d959c33577820c29b84e06_19920_8f169d2562dd3e61d79eb8c12eaf878d.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_30_1_hu1a10456908d959c33577820c29b84e06_19920_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_30_1_hu1a10456908d959c33577820c29b84e06_19920_34bfc6e0e7840b928b16c117155700df.webp"
               width="676"
               height="412"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<p>And what&rsquo;s even cooler is that by interpreting the neural network, we can actually learn a new process: the shape of the dependence between the resource growth rate and the water availability!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">water_avail</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span><span class="n">sort!</span><span class="p">(</span><span class="n">water_availability</span><span class="o">.</span><span class="p">(</span><span class="n">tsteps</span><span class="p">)),</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p_nn_trained</span> <span class="o">=</span> <span class="n">res_hybr</span><span class="o">.</span><span class="n">p_trained</span><span class="o">.</span><span class="n">p_nn</span>
</span></span><span class="line"><span class="cl"><span class="n">gr</span> <span class="o">=</span> <span class="n">neural_net</span><span class="p">(</span><span class="n">water_avail</span><span class="p">,</span> <span class="n">p_nn_trained</span><span class="p">,</span> <span class="n">st</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">water_avail</span><span class="p">[</span><span class="o">:</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">        <span class="n">gr</span><span class="p">[</span><span class="o">:</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">        <span class="n">label</span><span class="o">=</span><span class="s">&#34;Neural network&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">linestyle</span><span class="o">=</span><span class="s">&#34;--&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">gr_true</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">mp</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.*</span> <span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">.*</span> <span class="n">water_avail</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">water_avail</span><span class="p">[</span><span class="o">:</span><span class="p">],</span> <span class="n">gr_true</span><span class="p">[</span><span class="o">:</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#34;Ground truth&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">xlabel</span><span class="p">(</span><span class="s">&#34;Water availability (normalized)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ylabel</span><span class="p">(</span><span class="s">&#34;Resource basal growth rate&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span></span></code></pre></div>













<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/hybridmodelling/figures/HybridModelling_31_1_hu8f70bcdb8abe6eb9a982c0dd6084c9b6_29373_7209f55dc109b5ec7c99c9fbeb0e41a5.webp 400w,
               /post/hybridmodelling/figures/HybridModelling_31_1_hu8f70bcdb8abe6eb9a982c0dd6084c9b6_29373_82887ed09d654ed394323a5a43014a72.webp 760w,
               /post/hybridmodelling/figures/HybridModelling_31_1_hu8f70bcdb8abe6eb9a982c0dd6084c9b6_29373_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/hybridmodelling/figures/HybridModelling_31_1_hu8f70bcdb8abe6eb9a982c0dd6084c9b6_29373_7209f55dc109b5ec7c99c9fbeb0e41a5.webp"
               width="587"
               height="438"
               loading="lazy" data-zoomable /></div>
  </div></figure>
<h2 id="wrap-up">Wrap-up</h2>
<p>Hybrid approaches are the future! But they</p>
<ul>
<li>Require
<ul>
<li>domain <strong>specific knowledge</strong></li>
<li>expertise in <strong>mechanistic modelling</strong>
<ul>
<li>üëç <a href="https://github.com/vboussange/EcoEvoModelZoo.jl" target="_blank" rel="noopener">EcoEvoModelZoo.jl</a></li>
</ul>
</li>
<li>expertise in <strong>machine learning</strong>
<ul>
<li>üëç <a href="https://github.com/FluxML/model-zoo" target="_blank" rel="noopener">Flux.jl model zoo</a></li>
</ul>
</li>
</ul>
</li>
<li>Requires <strong>differentiable programming</strong> and <strong>interoperability</strong> between scientific libraries
<ul>
<li>
<p>What <img src="https://docs.julialang.org/en/v1/assets/logo.svg" width="100"/>
is best at</p>
</li>
<li>
<p>But JAX is also very cool ü´†</p>
</li>
</ul>
</li>
</ul>

    </div>

    




<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/ecology-and-evolution/">Ecology and evolution</a>
  
  <a class="badge badge-light" href="/tag/julia/">julia</a>
  
  <a class="badge badge-light" href="/tag/scientific-machine-learning/">Scientific Machine Learning</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://vboussange.github.io/post/hybridmodelling/&amp;text=On%20combining%20machine%20learning-based%20and%20theoretical%20ecosystem%20models" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://vboussange.github.io/post/hybridmodelling/&amp;t=On%20combining%20machine%20learning-based%20and%20theoretical%20ecosystem%20models" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=On%20combining%20machine%20learning-based%20and%20theoretical%20ecosystem%20models&amp;body=https://vboussange.github.io/post/hybridmodelling/" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://vboussange.github.io/post/hybridmodelling/&amp;title=On%20combining%20machine%20learning-based%20and%20theoretical%20ecosystem%20models" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=On%20combining%20machine%20learning-based%20and%20theoretical%20ecosystem%20models%20https://vboussange.github.io/post/hybridmodelling/" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://vboussange.github.io/post/hybridmodelling/&amp;title=On%20combining%20machine%20learning-based%20and%20theoretical%20ecosystem%20models" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  
    



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://vboussange.github.io"><img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu17fe142d2d9ea2daa3913aa53535eec6_854723_270x270_fill_q75_lanczos_center.jpg" alt="Victor Boussange"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://vboussange.github.io">Victor Boussange</a></h5>
      <h6 class="card-subtitle">Postdoctoral researcher</h6>
      <p class="card-text">Scientific machine learning and computational ecology.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:vic.boussange@gmail.com" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?user=SaQH5YoAAAAJ&amp;hl=en" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/vboussange" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="/uploads/cv.pdf" >
        <i class="ai ai-cv"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://orcid.org/0000-0002-4202-3599" target="_blank" rel="noopener">
        <i class="ai ai-orcid"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  
















  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  

  

  
  






  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    ¬© 2026 Me. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank">CC BY NC ND 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-nd fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>




  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> ‚Äî the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

      

    
    <script src="/js/vendor-bundle.min.3d946de2e8784a477845261d87025092.js"></script>

    
    
    
      

      
      

      

      
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/r.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/latex.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/julia.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    

    
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    
      
      
      
      
      
      
      
    

    

    
    
    
    <script id="page-data" type="application/json">{"use_headroom":true}</script>

    
    
      <script src="/js/wowchemy-headroom.e8fd2d733eef6a8bbbe0539398fc0547.js" type="module"></script>
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.de33c90527762392d440555c36739dd9.js"></script>

    
    
    
    
    
    
      
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      <script src="/js/wowchemy-publication.b0d291ed6d27eacec233e6cf5204f99a.js" type="module"></script>






</body>
</html>
